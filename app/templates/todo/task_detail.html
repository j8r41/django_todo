{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block title %}
  Task detail
{% endblock title %}
{% block content %}
  <div class="container mt-4">
    <div class="row">
      <div class="col-md-8">
        <h1>{{ object.title }}</h1>
        <p class="lead">{{ object.description }}</p>
        <p>
          <b>Created at:</b> {{ object.created_at }}
        </p>
        {% if object.end_date %}
          <p>
            <b>End date:</b> {{ object.end_date }}
          </p>
        {% endif %}
        <p>
          <b>Status:</b> {{ object.get_status_display }}
        </p>
        {% if object.files %}
          <p>
            <b>Files:</b> <a href="{{ object.files.url }}">{{ object.files }}</a>
          </p>
        {% endif %}
        {% if object.assigned_users.all %}
          <p>
            <b>Creator:</b> {{ object.user }}
          </p>
          <p>
            <b>Added users:</b>
            {% for user in task.assigned_users.all %}
              {{ user.username }}
              {% if not forloop.last %},{% endif %}
            {% endfor %}
          </p>
        {% endif %}
      </div>
    </div>
    <div class="row mt-4">
      {% if user.username == object.user.username %}
        <div class="col-md-8">
          <a href="{% url 'task_add_users' pk=object.pk %}"
             class="btn btn-primary me-2">Add Users</a>
          <a href="{% url 'task_edit' pk=object.pk %}"
             class="btn btn-primary me-2">Update</a>
          <a href="{% url 'task_delete' pk=object.pk %}"
             class="btn btn-danger me-2">Delete</a>
        </div>
      {% endif %}
      <div class="col-md-8 mt-2">
        <a href="{% url 'home' %}" class="btn btn-secondary">Back to List</a>
      </div>
    </div>
    {% if comments %}
      <h3 class="mt-4">Comments</h3>
      <ul class="list-unstyled">
        {% for comment in comments %}
          <li class="border-bottom pb-2 mb-2">
            <p>{{ comment.text }}</p>
            <p class="text-secondary">Posted by {{ comment.user }} on {{ comment.created_at }}</p>
          </li>
        {% empty %}
          <li>No comments yet.</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if comment_form %}
      <h3 class="mt-4">Add a comment</h3>
      <form method="post" action="{% url 'task_detail' task.pk %}">
        {% csrf_token %}
        {{ comment_form|crispy }}
        <button type="submit" class="btn btn-primary mt-2">Add comment</button>
      </form>
    {% else %}
      <p class="mt-4">
        Please <a href="{% url 'login' %}">log in</a> to add a comment.
      </p>
    {% endif %}
  </div>
{% endblock content %}
